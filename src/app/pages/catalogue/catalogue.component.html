<!-- catalogue.component.html -->
<section class="page p-6">
  <ng-container *ngIf="produits$ | async as produits; else loading">

    <div class="cards">
      <article class="card" *ngFor="let produit of produits; trackBy: trackById">

        <!-- IMAGE / CARROUSEL (on réutilise ton carrousel, mais dans le conteneur de la home) -->
        <div
          class="card__image carousel cat-carousel"
          (mouseenter)="onHoverStart(produit.id)"
          (mouseleave)="onHoverEnd(produit.id)"
        >
          <img
            class="cat-carousel__img"
            [src]="currentImage(produit)"
            [alt]="produit.nom"
            loading="lazy"
          />

          <!-- Prev/Next si plusieurs images -->
          <button
            *ngIf="produit.imageUrls.length > 1"
            class="cat-carousel__btn cat-carousel__btn--prev"
            type="button"
            (click)="prevImage(produit); $event.stopPropagation()"
            aria-label="Image précédente"
          >
            ‹
          </button>

          <button
            *ngIf="produit.imageUrls.length > 1"
            class="cat-carousel__btn cat-carousel__btn--next"
            type="button"
            (click)="nextImage(produit); $event.stopPropagation()"
            aria-label="Image suivante"
          >
            ›
          </button>

          <!-- Dots -->
          <div class="cat-carousel__dots" *ngIf="produit.imageUrls.length > 1">
            <button
              *ngFor="let _ of produit.imageUrls; let i = index"
              type="button"
              class="cat-carousel__dot"
              [class.is-active]="getIndex(produit.id) === i"
              (click)="setImage(produit, i); $event.stopPropagation()"
              [attr.aria-label]="'Aller à l’image ' + (i + 1)"
            ></button>
          </div>
        </div>

        <!-- CONTENU (mêmes classes que la home) -->
        <div class="card__body">
          <h3 class="card__title">{{ produit.nom }}</h3>

          <p
            class="text-xs text-gray-500"
            *ngIf="(produit.categorie?.length ?? 0) || (produit.sous_categorie?.length ?? 0)"
          >
            <span *ngIf="produit.categorie?.length">
              {{ (produit.categorie ?? []).join(' · ') }}
            </span>
            <span *ngIf="produit.sous_categorie?.length">
              <span *ngIf="produit.categorie?.length"> — </span>
              {{ (produit.sous_categorie ?? []).join(' · ') }}
            </span>
          </p>

          <p class="card__desc">{{ produit.description }}</p>

          <div class="card__footer">
            <span class="price">{{ produit.prix | currency:'EUR' }}</span>

            <button
              type="button"
              class="inline-flex items-center justify-center px-4 py-2 rounded-lg border border-blue-600 text-blue-600 hover:bg-blue-600 hover:text-white transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-600"
              (click)="AjouterAuPanier(produit)"
              [attr.aria-label]="'Ajouter ' + produit.nom + ' au panier'"
            >
              Ajouter au panier
            </button>
          </div>
        </div>

      </article>
    </div>

    <p *ngIf="produits.length === 0" class="text-center text-gray-500 mt-10">
      Aucun produit disponible pour le moment.
    </p>
  </ng-container>

  <ng-template #loading>
    <div class="text-center text-gray-500 py-10">
      Chargement du catalogue…
    </div>
  </ng-template>
</section>
